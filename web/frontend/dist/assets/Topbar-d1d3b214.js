import{t as W,u as X,a as m,l as Y,m as x,b9 as z,be as J,b as i,ca as K,S as Q,bp as Z,br as ee,bs as ae,j as t,e as p,I as b,G as S,aL as te,O as v,bq as ie,cb as re,cc as oe,cd as ce,ce as le,cf as ne}from"./index-885978b8.js";import{s as r}from"./FormStyle.module-55a0a2cc.js";/* empty css                              */import{L as M}from"./Link-376dd265.js";import{T as se}from"./TextField-2c415d65.js";import"./Labelled-5b2a4701.js";import"./InlineError-71d6bf79.js";const de=({handleRedirectToForm:u})=>{var B;const c=X(),[n,g]=m.useState({title:"New Form"}),O=Y.useAppBridge(),U=x.Fullscreen.create(O),j=z(),{editFormId:s}=J(),$=i(e=>e.shopId.shopId),F=i(e=>{var a;return(a=e.viewPort)==null?void 0:a.selectedViewport}),y=i(e=>e.formSetting.validationData.data.validation),L=i(e=>e.formSetting.appearanceData.data.appearance),R=i(e=>e.formSetting.afterSubmitData.data.afterSubmit),D=i(e=>{var a;return(a=e.formSetting.validationData)==null?void 0:a.updatedValidation}),N=i(e=>{var a;return(a=e.formSetting.appearanceData)==null?void 0:a.updatedAppearance}),I=i(e=>{var a;return(a=e.formSetting.afterSubmitData)==null?void 0:a.updatedAfterSubmit}),o=i(e=>{var a;return(a=e==null?void 0:e.inputField)==null?void 0:a.inputFields}),k=i(e=>{var a;return(a=e==null?void 0:e.inputField)==null?void 0:a.headerFieldData}),A=i(e=>{var a;return(a=e==null?void 0:e.inputField)==null?void 0:a.footerFieldData}),C=i(e=>{var a;return(a=e==null?void 0:e.inputField)==null?void 0:a.allElementData}),l=i(e=>{var a;return(a=e==null?void 0:e.inputField)==null?void 0:a.finalFormData}),w=i(e=>{var a;return(a=e.inputField)==null?void 0:a.isSaveOrUpdate}),G=i(e=>{var a,d,V;return(V=(d=(a=e==null?void 0:e.inputField)==null?void 0:a.editFormData)==null?void 0:d.formData)==null?void 0:V.customForm}),f=i(e=>{var a;return(a=e==null?void 0:e.inputField)==null?void 0:a.googelRecaptcha}),h=(B=K(G))==null?void 0:B.formTitle;i(e=>e.user.userData.user);const _=(e,a)=>{g({[e]:a})},T=e=>{c(ie(e))},E=m.useMemo(()=>{let e=[];return o.map(a=>{var d;(d=a==null?void 0:a.viewAccess)!=null&&d.includes(Q.PREMIUM)&&(e=[...e,a.id])}),e},[o]),P=m.useMemo(()=>{let e=[];return o.map(a=>{a!=null&&a.viewAccess||(e=[...e,a.id])}),e},[o]),q=()=>{const e={shopId:$,hasPremiumInput:E,hasFreeInput:P,enableReCaptcha:(f==null?void 0:f.enable)||!1,customForm:[{formTitle:n.title},{header:k},{element:o},{allElements:C},{footer:A}]};c(re({combinedObjectArr:e,updatedErrorMsg:D,updatedAppearance:N,updatedAfterSubmit:I}))},H=()=>{const e=[{formTitle:n.title},{header:k},{element:o},{allElements:C},{footer:A}];c(oe({_id:s,combinedObjectArr:{customForm:e,hasFreeInput:P,hasPremiumInput:E}})),c(ce({formId:s,validationData:D||y})),c(le({formId:s,appearanceData:N||L})),c(ne({formId:s,afterSubmitData:I||R}))};return m.useEffect(()=>{w&&(c(Z()),c(ee(!1)),c(ae(!1)),U.dispatch(x.Fullscreen.Action.EXIT),j("/form",{replace:!0}))},[w]),m.useEffect(()=>{h&&g({title:h})},[h]),t("div",{children:p("div",{className:r.topBar,children:[p("div",{className:r.sideBar,children:[t("div",{className:r.logo,onClick:u,children:t(M,{url:"/form",children:t(b,{source:S.backArrow,className:r.leftIcon})})}),t("div",{className:r.backTitle,onClick:u,children:t(M,{url:"/form",children:t("span",{children:"Back to List"})})})]}),t("div",{className:r.rightContext,children:p("div",{className:r.innerContext,children:[t("div",{className:r.formNameWrapper,children:t(se,{labelHidden:!0,name:"title",placeholder:"Enter Form Name",value:n==null?void 0:n.title,onChange:e=>_("title",e)})}),t("div",{className:r.itemViewPort,children:p("ul",{className:r.viewPortSelector,children:[t("li",{className:`${r.mobileView} ${F==="mobile"?r.ipsTabActive:""}`,onClick:()=>T("mobile"),children:t(b,{source:S.mobile})}),t("li",{className:`${r.desktopView} ${F==="desktop"?r.ipsTabActive:""}`,onClick:()=>T("desktop"),children:t(b,{source:S.desktop})})]})}),t("div",{className:r.itemAction,children:p(te,{children:[t(v,{onClick:u,children:"Cancel"}),s?t(v,{primary:!0,onClick:H,loading:l==null?void 0:l.loading,disabled:(o==null?void 0:o.length)===0,children:"Update"}):t(v,{primary:!0,onClick:q,loading:l==null?void 0:l.loading,disabled:(o==null?void 0:o.length)===0,children:"Save"})]})})]})})]})})},ve=W.memo(de);export{ve as default};

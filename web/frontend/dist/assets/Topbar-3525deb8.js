import{v as Y,u as q,a as c,m as z,n as Q,be as X,bk as Z,b as i,cd as ee,S as ae,bx as te,by as ie,j as t,e as u,J as v,K as F,aO as oe,U as g,bw as re,ce as se,cf as le,cg as ne,ch as ce,ci as de}from"./index-cdbbdef1.js";import{s as o}from"./FormStyle.module-55a0a2cc.js";/* empty css                              */import{L as y}from"./Link-aaa92430.js";import{T as me}from"./TextField-a28bba39.js";import"./Labelled-c5d2484a.js";import"./InlineError-fe270c03.js";const pe=({handleRedirectToForm:h})=>{var V;const l=q(),[m,D]=c.useState({title:"New Form"}),[M,O]=c.useState(!1),[f,j]=c.useState(""),$=z.useAppBridge();Q.Fullscreen.create($),X();const{editFormId:s}=Z(),L=i(e=>e.shopId.shopId),N=i(e=>{var a;return(a=e.viewPort)==null?void 0:a.selectedViewport}),R=i(e=>e.formSetting.validationData.data.validation),_=i(e=>e.formSetting.appearanceData.data.appearance),G=i(e=>e.formSetting.afterSubmitData.data.afterSubmit),I=i(e=>{var a;return(a=e.formSetting.validationData)==null?void 0:a.updatedValidation}),k=i(e=>{var a;return(a=e.formSetting.appearanceData)==null?void 0:a.updatedAppearance}),w=i(e=>{var a;return(a=e.formSetting.afterSubmitData)==null?void 0:a.updatedAfterSubmit}),r=i(e=>{var a;return(a=e==null?void 0:e.inputField)==null?void 0:a.inputFields}),A=i(e=>{var a;return(a=e==null?void 0:e.inputField)==null?void 0:a.headerFieldData}),C=i(e=>{var a;return(a=e==null?void 0:e.inputField)==null?void 0:a.footerFieldData}),E=i(e=>{var a;return(a=e==null?void 0:e.inputField)==null?void 0:a.allElementData}),d=i(e=>{var a;return(a=e==null?void 0:e.inputField)==null?void 0:a.finalFormData}),T=i(e=>{var a;return(a=e.inputField)==null?void 0:a.isSaveOrUpdate}),H=i(e=>{var a,n,p;return(p=(n=(a=e==null?void 0:e.inputField)==null?void 0:a.editFormData)==null?void 0:n.formData)==null?void 0:p.customForm}),b=i(e=>{var a;return(a=e==null?void 0:e.inputField)==null?void 0:a.googelRecaptcha}),S=(V=ee(H))==null?void 0:V.formTitle;i(e=>e.user.userData.user);const J=(e,a)=>{D({[e]:a})},P=e=>{l(re(e))},B=c.useMemo(()=>{let e=[];return r.map(a=>{var n;(n=a==null?void 0:a.viewAccess)!=null&&n.includes(ae.PREMIUM)&&(e=[...e,a.id])}),e},[r]),U=c.useMemo(()=>{let e=[];return r.map(a=>{a!=null&&a.viewAccess||(e=[...e,a.id])}),e},[r]),K=()=>{const e={shopId:L,hasPremiumInput:B,hasFreeInput:U,enableReCaptcha:(b==null?void 0:b.enable)||!1,customForm:[{formTitle:m.title},{header:A},{element:r},{allElements:E},{footer:C}]};l(se({combinedObjectArr:e,updatedErrorMsg:I,updatedAppearance:k,updatedAfterSubmit:w})).then(a=>{var n,p,x;(n=a==null?void 0:a.payload)!=null&&n.data&&(O(!0),j((x=(p=a==null?void 0:a.payload)==null?void 0:p.data)==null?void 0:x._id))})},W=()=>{const e=[{formTitle:m.title},{header:A},{element:r},{allElements:E},{footer:C}];l(le({_id:s||f,combinedObjectArr:{customForm:e,hasFreeInput:U,hasPremiumInput:B}})),l(ne({formId:s||f,validationData:I||R})),l(ce({formId:s||f,appearanceData:k||_})),l(de({formId:s||f,afterSubmitData:w||G}))};return c.useEffect(()=>{T&&(l(te(!1)),l(ie(!1)))},[T]),c.useEffect(()=>{S&&D({title:S})},[S]),t("div",{children:u("div",{className:o.topBar,children:[u("div",{className:o.sideBar,children:[t("div",{className:o.logo,onClick:h,children:t(y,{url:"/form",children:t(v,{source:F.backArrow,className:o.leftIcon})})}),t("div",{className:o.backTitle,onClick:h,children:t(y,{url:"/form",children:t("span",{children:"Back to List"})})})]}),t("div",{className:o.rightContext,children:u("div",{className:o.innerContext,children:[t("div",{className:o.formNameWrapper,children:t(me,{labelHidden:!0,name:"title",placeholder:"Enter Form Name",value:m==null?void 0:m.title,onChange:e=>J("title",e)})}),t("div",{className:o.itemViewPort,children:u("ul",{className:o.viewPortSelector,children:[t("li",{className:`${o.mobileView} ${N==="mobile"?o.ipsTabActive:""}`,onClick:()=>P("mobile"),children:t(v,{source:F.mobile})}),t("li",{className:`${o.desktopView} ${N==="desktop"?o.ipsTabActive:""}`,onClick:()=>P("desktop"),children:t(v,{source:F.desktop})})]})}),t("div",{className:o.itemAction,children:u(oe,{children:[t(g,{onClick:h,children:"Cancel"}),s||M?t(g,{primary:!0,onClick:W,loading:d==null?void 0:d.loading,disabled:(r==null?void 0:r.length)===0,children:"Update"}):t(g,{primary:!0,onClick:K,loading:d==null?void 0:d.loading,disabled:(r==null?void 0:r.length)===0,children:"Save"})]})})]})})]})})},ge=Y.memo(pe);export{ge as default};
